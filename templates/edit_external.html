{% extends "base.html" %}
{% block title %}{{ config['APP_TITLE'] }}{% endblock %}
{% block head %}
{{ super() }}
{% endblock %}

{% block content %}

<!-- //tabulator: -->
<!-- always up-to-date tabulator CDN -->
<link href="https://unpkg.com/tabulator-tables/dist/css/tabulator_simple.min.css" rel="stylesheet">
<script type="text/javascript" src="https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js"></script>


<!-- bootstrap 4 theme -->
<link href="https://unpkg.com/tabulator-tables/dist/css/bootstrap/tabulator_bootstrap4.min.css" rel="stylesheet">



<div class="row mb-3">
    <div class="col-md-12">
        <h1 id="import_header"> EXTERNAL IMPORTS</h1>
    </div>
</div>

<h4 id="resultsHeader" style="display:none">RESULTS:</h4>

<label class="font-weight-bold" for="submitText">Ontology:</label>

<div class="btn-group" role="group" aria-label="Basic example">
    <div class="dropright">
        <button class="btn btn-outline-success dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            Choose Ontology
        </button>
        <div id="ontology_selection_menu" class="dropdown-menu" aria-labelledby="dropdownMenu2">
            <!-- <button class="dropdown-item" type="button">Action</button>
        <button class="dropdown-item" type="button">Another action</button>
        <button class="dropdown-item" type="button">Something else here</button> -->
        </div>
    </div>

    <form id="submitText" class="form-inline">
        <input id="inputText" name="inputText" value="" placeholder='new Ontology ID'>
        <!-- <button type="submit" id="inputBtn" name="input" value="search" class="btn btn-outline-success fas fa-search"
        onclick="return submitForm(this)">Choose Ontology
    </button> -->
        <button type="submit" id="show-all-assigned" name="show_all_assigned" value="show_assigned"
            class="btn btn-outline-warning fas fa-plus" onclick="return submitForm(this)">
            Submit New Ontology
        </button>
    </form>
</div>
<br></br>
<div class="row">
    <div class="col-md-12">
        <div id="contentTable" class="table table-bordered table-striped table-hover table-sm"
            style="font-size: 0.8em; display:none;">
        </div>
    </div>
</div>


<script type="text/javascript">
    console.log("start");
    var table;
    var spreadsheets = {{ spreadsheets | safe}};
    console.log(spreadsheets);

    var externalImportsRowData = {{ rows1 | safe}};
    var newLabelsRowData = {{ rows2 | safe}};
    var newParentsRowData = {{ rows3 | safe}};
    console.log(externalImportsRowData);
    console.log(newLabelsRowData);
    console.log(newParentsRowData);

    var rowLength = externalImportsRowData.length;
    var headerLength = 6; //todo: get this from back end?
    var ontologyIDs = [];
    for (var i = 0; i < rowLength; i++) {
        ontologyIDs.push(externalImportsRowData[i]["Ontology ID"]);
    }
    console.log("Ontology IDs: " + ontologyIDs); //correct

    var currentOntology = "BCIO";
    //from rep.html:
    function submitForm(button) {
        var newID = $("#inputText").val();
        ontologyIDs.push(newID);
        console.log("new ontologyIDs: " + ontologyIDs);
        createInput(ontologyIDs); // is this working?
        $("#inputText").val("");
        $("#dropdownMenu2").click();
        return false; //todo: is this necessary
    }

    function createInput(inputArray) {
        $(".dropdown-item").remove(); //first remove all 
        for (item in inputArray) {
            var $input = $("<a href='#' class='dropdown-item' type='button' value='" + inputArray[item] + "' onclick=\"function hi(){currentOntology = '" + inputArray[item] + "';};hi(); return false;\"" + " >" + inputArray[item] + "</a>");

            // var $input = $("<input href='#' class='dropdown-item' type='button' value='" + inputArray[item] + "' />");
            $input.appendTo($("#ontology_selection_menu"));
        }

        $(".dropdown-item").click(function () {
            console.log(currentOntology); //got it!
            testDataArray = [
                { id: 1, ontology: currentOntology },
            ];
            table.replaceData(testDataArray);
            // createTable(testDataArray); //todo: new table not accessible anymore, as the old one is still present somewhere...
           
        });

    }

    // function createTable(responseData, type) {
    function createTable(inputData) {
        // bootbox.hideAll();
        // if (responseData.length < 1) {
        //   document.getElementById("resultsHeader").innerHTML = "No Results";
        // } else {
        //   document.getElementById("resultsHeader").innerHTML = "RESULTS - click on a row to open its spreadsheet:";
        // }
        
            table = new Tabulator("#contentTable", {
                data: inputData,

                columns: [ //Define Table Columns
                    { title: "Ontology", field: "ontology", formatter: "textarea", width: "120" },
                ],
                // height: window.innerHeight / 3 * 2,
                layout: "fitColumns",
                pagination: "local",
                paginationSize: "50",
            });

            
        
    }

    window.addEventListener("load", function () {
        createInput(ontologyIDs);
        var testDataArray = [];
        //below works, to build table data:
        // for(i in ontologyIDs){
        //     let item = {
        //         "id": i,
        //         "ontology": ontologyIDs[i]
        //     }
        //     testDataArray.push(item);

        //initialise table:
        var testDataArray = [
            { id: 1, ontology: currentOntology },
        ];
        createTable(testDataArray);
        
        // $(".dropdown-item").click(function () {
        //     console.log(currentOntology); //got it!
        //     testDataArray = [
        //         { id: 1, ontology: currentOntology },
        //     ];
        //     // table.replaceData(testDataArray);
        //     // createTable(testDataArray); //todo: new table not accessible anymore, as the old one is still present somewhere...
           
        // });
    })

</script>

{% endblock %}

{%block javascript%}

{% endblock %}